# Day 3 – API Gateway vs Load Balancer

## Why Both Exist

In modern microservice architectures, both an API Gateway and a Load Balancer are required because they operate at different layers and solve different problems.

---

## Load Balancer

A Load Balancer operates at the infrastructure level and focuses on:
- Instance health checks
- Load distribution
- Failover and high availability

It decides **which instance** of a service should receive a request.

Load balancers do not handle application-level concerns such as authentication or API contracts.

---

## API Gateway

An API Gateway operates at the client boundary and focuses on:
- Authentication and authorization
- Rate limiting and throttling
- API versioning
- Request validation
- Routing requests to the correct backend service

It decides **which service** should handle a request.

---

## How They Work Together

Typical request flow:
Client → API Gateway → Load Balancer → Service Instances

- API Gateway determines the target service
- Load Balancer selects a healthy instance of that service

---

## Key Insight

API Gateway and Load Balancer are complementary, not interchangeable.

---

## Microservices Architecture with API Gateway (Flowchart)

                 ┌──────────────────┐
                 │     Clients      │
                 │ (Web / Mobile /  │
                 │  External APIs)  │
                 └────────┬─────────┘
                          │
                          ▼
                 ┌──────────────────┐
                 │   API Gateway    │
                 │------------------│
                 │ • Auth (JWT)     │
                 │ • Rate Limiting  │
                 │ • Validation     │
                 │ • API Versioning │
                 │ • Routing        │
                 └────────┬─────────┘
            ┌─────────────┼─────────────┐
            │             │             │
            ▼             ▼             ▼
     ┌────────────┐ ┌────────────┐ ┌────────────┐
     │ Load       │ │ Load       │ │ Load       │
     │ Balancer   │ │ Balancer   │ │ Balancer   │
     │ (User Svc) │ │ (Order Svc)│ │ (Pay Svc)  │
     └─────┬──────┘ └─────┬──────┘ └─────┬──────┘
           │              │              │
   ┌───────┼───────┐  ┌───┼───────┐  ┌───┼───────┐
   ▼       ▼       ▼  ▼   ▼       ▼  ▼   ▼       ▼
┌────┐ ┌────┐ ┌────┐┌────┐┌────┐┌────┐┌────┐┌────┐
│ U1 │ │ U2 │ │ U3 ││ O1 ││ O2 ││ O3 ││ P1 ││ P2 │
└────┘ └────┘ └────┘└────┘└────┘└────┘└────┘└────┘

- Clients do not directly talk to individual services. All requests first go through an API Gateway, which acts as a single entry point.
- The API Gateway handles cross-cutting concerns like authentication, rate limiting, validation, and routing.
- Based on the API path or business capability, the gateway routes the request to the appropriate backend service.
- This separation allows the API Gateway to focus on client concerns, while load balancers focus on infrastructure reliability.

---

## API Gateway vs Load Balancer

| Concern           | API Gateway       | Load Balancer      |
| ----------------- | ----------------- | ------------------ |
| Service discovery | ❌                 | ✅                  |
| Instance health   | ❌                 | ✅                  |
| Request routing   | ✅ (service-level) | ✅ (instance-level) |
| Rate limiting     | ✅                 | ❌                  |
| Auth / JWT        | ✅                 | ❌                  |

---

## DNS and Front Door.

Flow:

    Client
    ↓
    DNS / Azure Front Door
    ↓
    [ LB ]  → API Gateway instance A
            → API Gateway instance B
    ↓
    API Gateway (routing, auth, rate limit)
    ↓
    [ Service LB ]
    ↓
    Service Instance 1
    Service Instance 2
    Service Instance 3

DNS: 
    - DNS converts names → IP addresses. Without DNS, You’d have to remember IP addresses.
    - DNS does NOT: Load balancing, Authentication, Health checks. It only tells: This is the address to contact.

Front Door:
    - Think of Azure Front Door (or AWS CloudFront / ALB) as: A global, intelligent entry gate to your system.
    - Front Door sits after DNS, before your system.
    - Flow:
        Client
        ↓
        DNS (name → IP)
        ↓
        Front Door
        ↓
        API Gateway / Services
    - What Front Door DOES: Routes traffic to nearest region, Performs health checks, Handles SSL termination, Global load balancing, Failover between regions.
    - What it does NOT do: Business logic, Service routing based on APIs.
    
-> Why Front Door Exists (The Real Reason):
   Without Front Door:
    - Users in India hit US servers ❌
    - Region failure = total outage ❌
    - No global traffic optimization ❌
   With Front Door:
    - User hits nearest healthy region
    - Failover is automatic
    - Latency improves massively.

---